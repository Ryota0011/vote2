<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>æŠ•ç¥¨ã‚¯ã‚¤ã‚º</title>
  <style>
    body {
      font-family: "Hiragino Kaku Gothic ProN", sans-serif;

      background: url('image1.png') no-repeat center center fixed;
      background-size: cover;

      margin: 0;
      padding: 0;
      text-align: center;

  
    }

    header {
  background: rgba(0,0,0,1);
  padding: 15px 30px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.4);
}

.header-content {
  display: flex;
  align-items: center;
  justify-content: center; /* ä¸­å¤®å¯„ã› */
  gap: 15px; /* ãƒ­ã‚´ã¨æ–‡å­—ã®é–“éš” */
}

header img.logo {
  height: 50px;
  width: auto;
}

header .site-title {
  font-family: 'Kosugi Maru', sans-serif;
  font-size: 26px;
  font-weight: bold;
  color: #fff;
  letter-spacing: 1.5px;
}

    .container {
      max-width: 600px;
      margin: 50px auto;
      background: rgba(255, 255, 255, 0.9);
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      flex: 1;
    }

    .layout {
  display: flex;
  justify-content: center;
  align-items: flex-start;
  gap: 20px; /* å·¦å³ã®é–“éš” */
  margin: 20px;
  align-items: stretch;
}

.ad-space {
  width: 160px;
      min-height: 600px;
      background: #eee;
      padding: 10px;
      text-align: center;
      font-size: 14px;
      color: #555;
      border-radius: 8px;
      min-height: auto;
}
  

    h1 {
      font-size: 24px;
      margin-bottom: 20px;
    }

    .choice {
      display: block;
      width: 100%;
      padding: 15px;
      margin: 10px 0;
      font-size: 18px;
      border: 2px solid transparent;
      border-radius: 8px;
      background: #f1f1f1;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .choice:hover {
      border: 2px solid #ff9800;
      background: #fff8e1;
    }

    .selected {
      border: 2px solid #ff9800;
      background: #ffe680;
    }

    .result {
      margin-top: 20px;
      font-size: 16px;
    }

    .bar-container {
      width: 100%;
      background: #eee;
      border-radius: 10px;
      margin: 5px 0;
      height: 20px;
      overflow: hidden;
    }

    .bar {
      height: 100%;
      background: #ff6b6b;
      text-align: right;
      color: white;
      font-size: 14px;
      padding-right: 5px;
    }

    .age-result {
      margin-top: 20px;
      padding: 15px;
      background: #fff7e6;
      border-left: 5px solid #ff9900;
      border-radius: 8px;
      text-align: left;
    }

    .btn {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 18px;
      border: none;
      border-radius: 8px;
      background: #007acc;
      color: #fff;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn:hover {
      background: #005fa3;
    }

    footer {
      background: rgba(0, 0, 0, 0.85); /* ãƒ˜ãƒƒãƒ€ãƒ¼ã¨åŒã˜é»’ç³» */
      color: #fff;
      text-align: center;
      padding: 20px 10px;
      font-size: 14px;
      margin-top: 40px; /* æœ¬æ–‡ã¨ã®é–“ã«ä½™ç™½ */
    }
    
    
    footer a {
      color: #ffcc66; /* ãƒªãƒ³ã‚¯ã¯ã¡ã‚‡ã£ã¨ç›®ç«‹ã¤è‰² */
      text-decoration: none;
      margin: 0 5px;
    }
    
    footer a:hover {
      text-decoration: underline;
    }

    /* âœ… ã‚¹ãƒãƒ›ã‚„ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã§å¹…ãŒ768pxä»¥ä¸‹ã®ã¨ã */
@media screen and (max-width: 768px) {

  .layout {
    flex-direction: column;         /* åºƒå‘Šâ†’ã‚³ãƒ³ãƒ†ãƒ³ãƒ„â†’åºƒå‘Šã®ç¸¦ä¸¦ã³ */
    align-items: center;
  }

  .ad-space {
    width: 90%;                     /* åºƒå‘Šã‚‚å¹…ã‚’åºƒã’ã‚‹ */
    min-height: auto;
    margin-bottom: 15px;
  }

  .container {
    width: 90%;                     /* ã‚¯ã‚¤ã‚ºæœ¬ä½“ã‚’ã‚¹ãƒãƒ›å¹…ã« */
    margin: 20px auto;
    padding: 20px;
  }

  .choice {
    font-size: 16px;                /* é¸æŠè‚¢ã®æ–‡å­—ã‚µã‚¤ã‚ºã‚’å°‘ã—ç¸®å° */
    padding: 12px;
  }

  h1 {
    font-size: 20px;                /* å•é¡Œæ–‡ã‚‚ç¸®å° */
  }

  .btn {
    width: 100%;                    /* çµæœãƒœã‚¿ãƒ³ã‚’æ¨ªã„ã£ã±ã„ã« */
    font-size: 16px;
  }

  header img.logo {
    height: 40px;                   /* ãƒ­ã‚´ã‚‚å°‘ã—ç¸®å° */
  }

  header .site-title {
    font-size: 20px;
  }

  footer {
    font-size: 12px;                /* ãƒ•ãƒƒã‚¿ãƒ¼ã‚‚å°‘ã—å°ã•ã */
  }
}

  </style>
</head>
<body>

  <header onclick="window.location.href='index.html'" style="cursor: pointer;">
  <div class="header-content">
    <img src="image-logo.png" alt="ãƒ­ã‚´" class="logo">
    <span class="site-title">ãƒãƒƒãƒ‰ãƒ©ãƒœ -äººé–“è¦³å¯Ÿãƒãƒ£ãƒ³ãƒãƒ«-</span>
  </div>
  <link href="https://fonts.googleapis.com/css2?family=Kosugi+Maru&display=swap" rel="stylesheet">

  </header>

  <div class="layout">
  <div class="ad-space left-ad">
    <!-- å·¦å´åºƒå‘Š -->
    <p>åºƒå‘Šã‚¹ãƒšãƒ¼ã‚¹</p>
  </div>


<div class="container">
  <h1 id="question-text">èª­ã¿è¾¼ã¿ä¸­...</h1>

  <button class="choice" id="choiceA" onclick="selectChoice(0)">é¸æŠè‚¢A</button>
  <button class="choice" id="choiceB" onclick="selectChoice(1)">é¸æŠè‚¢B</button>

  <div id="result-area" class="result"></div>

  <div>
    <button class="btn" id="action-btn" onclick="showResult()">çµæœã‚’è¦‹ã‚‹</button>
  </div>
  <button class="btn home-btn" onclick="window.location.href='index-top.html'">ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</button>
</div>

<script>
  // ===== ã‚¯ã‚¤ã‚ºãƒ‡ãƒ¼ã‚¿3å• =====
  const questions = [
    { q: "é›»è»Šã®ä¸­ã§ã¯é™ã‹ã«ã™ã‚‹", choices: ["å…±æ„Ÿã™ã‚‹", "å…±æ„Ÿã—ãªã„"] },
    { q: "æ¨ªå…¥ã‚Šã—ãªã„", choices: ["å…±æ„Ÿã™ã‚‹", "å…±æ„Ÿã—ãªã„"] },
    { q: "ãƒã‚¤æ¨ã¦ã‚’ã—ãªã„", choices: ["å…±æ„Ÿã™ã‚‹", "å…±æ„Ÿã—ãªã„"] }
  ];

  let currentIndex = 0;
  let selectedChoice = null;

  const questionText = document.getElementById("question-text");
  const choiceA = document.getElementById("choiceA");
  const choiceB = document.getElementById("choiceB");
  const resultArea = document.getElementById("result-area");
  const actionBtn = document.getElementById("action-btn");

  // åˆå›ãƒ­ãƒ¼ãƒ‰
  loadQuestion();

  function loadQuestion() {
    const q = questions[currentIndex];
    questionText.textContent = `Q${currentIndex + 1}. ${q.q}`;
    choiceA.textContent = q.choices[0];
    choiceB.textContent = q.choices[1];

    // åˆæœŸåŒ–
    selectedChoice = null;
    choiceA.classList.remove("selected");
    choiceB.classList.remove("selected");
    resultArea.innerHTML = "";
    actionBtn.textContent = "çµæœã‚’è¦‹ã‚‹";
    actionBtn.onclick = showResult;
  }

  function selectChoice(choice) {
    selectedChoice = choice;
    choiceA.classList.remove("selected");
    choiceB.classList.remove("selected");
    if (choice === 0) choiceA.classList.add("selected");
    if (choice === 1) choiceB.classList.add("selected");
  }

    async function showResult() {
    if (selectedChoice === null) {
      alert("ã©ã¡ã‚‰ã‹ã‚’é¸æŠã—ã¦ãã ã•ã„");
      return;
    }

    const PAGE_ID = "page12";  // â† ãƒšãƒ¼ã‚¸ã”ã¨ã«å¤‰ãˆã‚‹
    const questionId = `${PAGE_ID}_q${currentIndex + 1}`;

    const choice = selectedChoice === 0 ? "A" : "B";

    // Firebaseã«æŠ•ç¥¨é€ä¿¡
    await vote(questionId, choice);

    // Firebaseã‹ã‚‰çµæœã‚’å–å¾—
    const { percentA, percentB } = await getResults(questionId);

    // ãƒ©ãƒ³ãƒ€ãƒ ã§å¹´ä»£åˆ¥ãƒ‡ãƒ¼ã‚¿ï¼ˆä»®ï¼‰
    function rand() { return Math.floor(Math.random() * 100); }
    let age20 = rand(), age30 = rand(), age40 = rand();

    let resultHTML = `<p>ã‚ãªãŸã®é¸æŠï¼š<strong>${questions[currentIndex].choices[selectedChoice]}</strong></p>`;
    resultHTML += `<p>ã¿ã‚“ãªã®çµæœã¯â€¦</p>`;
    resultHTML += `
      <div>${questions[currentIndex].choices[0]} (${percentA}%)</div>
      <div class="bar-container"><div class="bar" style="width:${percentA}%"></div></div>
      <div>${questions[currentIndex].choices[1]} (${percentB}%)</div>
      <div class="bar-container"><div class="bar" style="width:${percentB}%; background:#4dabf7;"></div></div>
    `;

    resultHTML += `<div class="age-result">
      <h3>å¹´ä»£åˆ¥ã®æŠ•ç¥¨çµæœ</h3>
      <div>20ä»£: ${age20}%<div class="bar-container"><div class="bar" style="width:${age20}%; background:#ff6699;"></div></div></div>
      <div>30ä»£: ${age30}%<div class="bar-container"><div class="bar" style="width:${age30}%; background:#66cc66;"></div></div></div>
      <div>40ä»£ä»¥ä¸Š: ${age40}%<div class="bar-container"><div class="bar" style="width:${age40}%; background:#3366ff;"></div></div></div>
    </div>`;

    resultArea.innerHTML = resultHTML;

    // ãƒœã‚¿ãƒ³åˆ‡ã‚Šæ›¿ãˆ
    if (currentIndex < questions.length - 1) {
      actionBtn.textContent = "æ¬¡ã®è³ªå•ã¸";
      actionBtn.onclick = nextQuestion;
    } else {
      actionBtn.textContent = "ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹";
      actionBtn.onclick = () => {
        window.location.href = "index.html";
      };
    }
  }


  function nextQuestion() {
    currentIndex++;
    loadQuestion();
  }
</script>

<div class="ad-space right-ad">
    <!-- å³å´åºƒå‘Š -->
    <p>åºƒå‘Šã‚¹ãƒšãƒ¼ã‚¹</p>
  </div>
</div>

  <footer>
  <p>Â© 2025 ãƒãƒƒãƒ‰ãƒ©ãƒœ - äººé–“è¦³å¯Ÿãƒãƒ£ãƒ³ãƒãƒ« -</p>
  <p><a href="#">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a> | <a href="#">ãŠå•ã„åˆã‚ã›</a></p>
  </footer>


<script type="module">
  // âœ… å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­ã¿è¾¼ã¿
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
  import { getDatabase, ref, runTransaction, get } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-database.js";

  // âœ… ã‚ãªãŸã®Firebaseè¨­å®šãã®ã¾ã¾ä½¿ã†
  const firebaseConfig = {
    apiKey: "AIzaSyC9_TqRUvhWmZ9FsKWSUQ-Db7BrjKNtgFw",
    authDomain: "madlab-vote.firebaseapp.com",
    databaseURL: "https://madlab-vote-default-rtdb.firebaseio.com/",
    projectId: "madlab-vote",
    storageBucket: "madlab-vote.firebasestorage.app",
    messagingSenderId: "588437962595",
    appId: "1:588437962595:web:60ba270b69d711e2bb1d56",
    measurementId: "G-4YB2QG27EB"
  };

  // âœ… FirebaseåˆæœŸåŒ–
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  console.log("âœ… Firebaseæ¥ç¶šOKï¼");

  


async function getVoteResults(questionId) {
  const voteRef = ref(db, `votes/${questionId}`);
  const snapshot = await get(voteRef);

  if (snapshot.exists()) {
    const data = snapshot.val();
    const total = (data.A || 0) + (data.B || 0);
    const percentA = total > 0 ? Math.round((data.A || 0) / total * 100) : 0;
    const percentB = total > 0 ? Math.round((data.B || 0) / total * 100) : 0;

    console.log(`çµæœ: A=${percentA}%, B=${percentB}%`);
  } else {
    console.log("ã¾ã ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“");
  }
}

// ãƒ†ã‚¹ãƒˆ
getVoteResults("q1");

  // âœ… æŠ•ç¥¨ã™ã‚‹é–¢æ•° (questionId = "q1", choice = "A" or "B")
  async function vote(questionId, choice) {
    const voteRef = ref(db, `votes/${questionId}/${choice}`);
    await runTransaction(voteRef, (current) => (current || 0) + 1);
    console.log(`ğŸ‘ æŠ•ç¥¨é€ä¿¡: ${questionId} â†’ ${choice}`);
  }

  

  // âœ… æŠ•ç¥¨çµæœã‚’èª­ã¿è¾¼ã‚€é–¢æ•°
  async function getResults(questionId) {
  const snapshot = await get(ref(db, `votes/${questionId}`));
  const data = snapshot.val() || { A: 0, B: 0 };
  const total = (data.A || 0) + (data.B || 0);

  const safePercent = (value, total) => total > 0 ? Math.round((value / total) * 100) : 0;

  return {
    percentA: safePercent(data.A || 0, total),
    percentB: safePercent(data.B || 0, total),
    total
  };
}

  window.vote = vote;
  window.getResults = getResults;

  // âœ… ãƒ†ã‚¹ãƒˆç”¨
  window.testVote = () => vote("q1", "A");
  window.testLoad = async () => console.log(await getResults("q1"));
</script>



</body>
</html>
